<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IP Address Lookup</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        form { margin-bottom: 20px; }
        input[type=text] { padding: 8px; width: 250px; }
        button { padding: 8px 15px; cursor: pointer; }
        #map { height: 400px; margin-top: 20px; border-radius: 8px; }
        .info-box { margin-top: 20px; }
    </style>
</head>
<body>

    <h1>üîé IP Address Lookup Tool</h1>

    <!-- Search Bar -->
    <form method="POST" action="/">
        <input type="text" name="ip_address" placeholder="Enter IP address (e.g., 8.8.8.8)">
        <button type="submit">Search</button>
    </form>

    {% if info.error %}
        <p style="color: red;">Error: {{ info.error }}</p>
    {% else %}
        <div class="info-box">
            <h2>IP Information {{ "(Searched: " ~ searched_ip ~ ")" if searched_ip else "(Your IP)" }}</h2>
            <ul>
                <li><b>IP:</b> {{ info.ip }}</li>
                <li><b>City:</b> {{ info.city }}</li>
                <li><b>Region:</b> {{ info.region }}</li>
                <li><b>Country:</b> {{ info.country_name }}</li>
                <li><b>ISP:</b> {{ info.org }}</li>
                <li><b>ASN:</b> {{ info.asn }}</li>
                <li><b>Latitude:</b> {{ info.latitude }}</li>
                <li><b>Longitude:</b> {{ info.longitude }}</li>
            </ul>
        </div>

        <!-- Map -->
        <div id="map"></div>
    {% endif %}

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        {% if info.latitude and info.longitude %}
        var map = L.map('map').setView([{{ info.latitude }}, {{ info.longitude }}], 10);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        L.marker([{{ info.latitude }}, {{ info.longitude }}]).addTo(map)
            .bindPopup("üìç {{ info.city }}, {{ info.country_name }}<br>IP: {{ info.ip }}")
            .openPopup();
        {% endif %}
    </script>
</body>
</html>
